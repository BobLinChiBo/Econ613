choice_mean <- function(chosen, choice_var, mean_var, data){
result <- data %>% filter(eval(parse(text=choice_var)) == chosen) %>% mutate(mean_var = mean(mean_var))
return(result)
}
a <- choice_mean(chosen = "arts",data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
View(a)
a %>% mutate(aaa = mean("score"))
choice_mean <- function(chosen, choice_var, mean_var, data){
result <- data %>% filter(eval(parse(text=choice_var)) == chosen) %>% mutate(mean_var = mean(eval(parse(text=mean_var))))
return(result)
}
a <- choice_mean(chosen = "arts",data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
View(a)
a[1,aaa]
a[1,"aaa"]
View(a)
a[1,"mean_var"]
choice_mean <- function(chosen, choice_var, mean_var, data){
result <- data %>% filter(eval(parse(text=choice_var)) == chosen) %>% mutate(mean_var = mean(eval(parse(text=mean_var))))
return(result[1,mean_var])
}
a <- choice_mean(chosen = "arts",data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
View(a)
choice_mean <- function(chosen, choice_var, mean_var, data){
result <- data %>% filter(eval(parse(text=choice_var)) == chosen) %>% mutate(mean_var = mean(eval(parse(text=mean_var))))
return(result[1,"mean_var"])
}
a <- choice_mean(chosen = "arts",data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
View(a)
sapply(choices_q5, choice_mean, data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
choice_mean <- function(chosen, choice_var, mean_var, data){
print(chosen)
result <- data %>% filter(eval(parse(text=choice_var)) == chosen) %>% mutate(mean_var = mean(eval(parse(text=mean_var))))
return(result[1,"mean_var"])
}
sapply(choices_q5, choice_mean, data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
choice_mean <- function(chosen, choice_var, mean_var, data){
result <- data %>% filter(eval(parse(text=choice_var)) == chosen) %>% pull(mean_var)
return(mean(result))
}
a <- choice_mean(chosen = "arts",data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
choices_q5
sapply(choices_q5 %>% pull(pgm_rev), choice_mean, data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
choices_mean <-
sapply(choices_q5 %>% pull(pgm_rev), choice_mean,
data = ind_recode_score_first.sample,
choice_var = "pgm_rev", mean_var = "score")
View(z)
z <- t(choices_mean)
View(z)
as.data.frame(choices_mean)
z <- as.data.frame(choices_mean)
colnames(z) = score
colnames(z) = "score"
View(z)
effects(object = mlogit_result_q5,
covariate = "score", data = z)
View(marginal_effect_q5)
View(mlogit_result_q5)
View(own_result_q5)
?summarise
ind_recode_score_first_d.sample %>% summarise(mean)
View(ind_recode_score_first_d.sample)
ind_recode_score_first_d.sample %>% summarise()
ind_recode_score_first_d.sample %>% summarise(mean())
ind_recode_score_first_d.sample %>% summarise_all(mean)
marginal_effect_var <- function(var, data, coefficients, choices){
new_data <- data %>% summarise_all(mean)
h <-  data * 0
h[, var] <- 1 / 100
likelihood_h <- likelihood_logit(coefficients = coefficients, data = data + h, choices = choices)
h_likelihood <- likelihood_logit(coefficients = coefficients, data = data - h, choices = choices)
marginal_effect_var <- mean((likelihood_h - h_likelihood) / (2 * h[, var]))
return(marginal_effect_var)
}
marginal_effect_q5 <- marginal_effect(data = ind_recode_score_first_d.sample,
coefficients = own_result_q5$par, choices = choices_no_head_q5)
View(marginal_effect_q5)
View(choices)
View(choices_no_head_q5)
?pull
marginal_effect <- function(data, coefficients, choices){
vars <- choices %>% pull(1)
marginal_effect <- sapply(vars, marginal_effect_var,
data = data, coefficients = coefficients, choices = choices)
marginal_effect <- as.matrix(marginal_effect, ncol = 1)
colnames(marginal_effect) = "marginal_effect"
return(marginal_effect)
}
View(z)
effects(object = mlogit_result_q5,
covariate = "score", data = z)
a <- effects(object = mlogit_result_q5,
covariate = "score", data = z)
View(marginal_effect_q5)
View(z)
colnames(z) = "marginal_effect"
View(z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
for (chosen in choices) {
chosen_index <- grep(chosen, colnames(choices))
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
for (chosen in choices %>% pull(1)) {
chosen_index <- grep(chosen, colnames(choices))
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
print(colnames(choices))
for (chosen in choices %>% pull(1)) {
print(choices %>% pull(1))
chosen_index <- grep(chosen, colnames(choices))
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
print(choices)
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
print(mean_data)
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
print(mean_data[chosen, 1])
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
View(choices_q5)
View(z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
print(mean_data[chosen, 1])
chosen_index <- grep(chosen, choices)
print(chosen_index)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
print(coefficients[ length(coefficients)/2 + chosen_index-1 ])
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5, choices = choices_q5, mean_data = z)
a <- marginal_effect(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
View(a)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
print(get(paste("utility", i, sep = "")))
marginal_effect[i, "marginal_effect"] = get(paste("utility", i, sep = "")) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
marginal_effect <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
marginal_effect <- mean_data
colnames(marginal_effect) = "marginal_effect"
i <- 1
for (chosen in choices) {
marginal_effect[i, "marginal_effect"] = exp(get(paste("utility", i, sep = ""))) / sum_exp_utility_mean
i = i + 1
}
return(marginal_effect)
}
a <- marginal_effect(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
View(a)
choices_prob_mean <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
choices_prob_mean <- mean_data
colnames(choices_prob_mean) = "prob_at_mean"
i <- 1
for (chosen in choices) {
choices_prob_mean[i, "prob_at_mean"] = exp(get(paste("utility", i, sep = ""))) / sum_exp_utility_mean
i = i + 1
}
return(choices_prob_mean)
}
a <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
View(a)
h <- z*0
h[1,1] = z[1,1] /1000
a1 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z + h)
a2 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z - h)
View(a2)
View(a1)
View(a)
View(h)
z+h
View(z)
choices_prob_mean <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
print(mean_data[chosen, 1])
print(coefficients[ length(coefficients)/2 + chosen_index-1 ])
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
choices_prob_mean <- mean_data
colnames(choices_prob_mean) = "prob_at_mean"
i <- 1
for (chosen in choices) {
choices_prob_mean[i, "prob_at_mean"] = exp(get(paste("utility", i, sep = ""))) / sum_exp_utility_mean
i = i + 1
}
return(choices_prob_mean)
}
a1 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z + h)
h <- z/100
a <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
a1 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z + h)
choices_prob_mean <- function(choices, coefficients, mean_data){
sum_exp_utility_mean <- 0
choices <- choices %>% pull(1)
for (chosen in choices) {
chosen_index <- grep(chosen, choices)
chosen_index_string <- paste("utility", chosen_index, sep = "")
if(chosen_index == 1){
utility <- 0
}
else{
utility <- coefficients[chosen_index-1] + mean_data[chosen, 1] * coefficients[ length(coefficients)/2 + chosen_index-1 ]
}
assign(chosen_index_string, utility)
sum_exp_utility_mean = sum_exp_utility_mean + exp(utility)
}
choices_prob_mean <- mean_data
colnames(choices_prob_mean) = "prob_at_mean"
i <- 1
for (chosen in choices) {
choices_prob_mean[i, "prob_at_mean"] = exp(get(paste("utility", i, sep = ""))) / sum_exp_utility_mean
i = i + 1
}
return(choices_prob_mean)
}
a <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
a1 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z + h)
a2 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z - h)
View(a)
View(a1)
(a1-a2)/(2/100)
h <- z/1000
a1 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z + h)
a2 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z - h)
(a1-a2)/(2/1000)
View(z)
colnames(z) = "score"
b <- effects(object = mlogit_result_q5,
covariate = "score", data = z)
b
a1-a2
h <- 1/1000
a1 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z + h)
a2 <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z - h)
(a1-a2)/(2/1000)
z
z+h
h
marginal_effect <- function(choices, coefficients, mean_data){
h <- 1/1000
h_prob <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
prob_h <- choices_prob_mean(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
marginal_effect <- (h_prob - prob_h) / (2*h)
return(marginal_effect)
}
marginal_effect_q5 <- marginal_effect(coefficients = own_result_q5$par, choices = choices_q5, mean_data = z)
