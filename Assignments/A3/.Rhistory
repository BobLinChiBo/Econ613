ind_school_program_enter %>%
group_by(schoolcode) %>%
mutate(school_size = sum(enter_school)) %>%
group_by(schoolcode, choicepgm) %>%
mutate(program_size = sum(enter_program)) %>%
filter(enter_program == TRUE & enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
mutate(program_quality = mean(score),
program_cutoff = min(score)) %>%
group_by(schoolcode) %>%
mutate(school_quality = mean(score),
school_cutoff = min(score))
### 2
## 2.1
ind_school_program_enter <-
ind_school_enter %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank)))
View(program_size)
View(program_size)
?summarise
program_size <-
ind_school_program_enter %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_size = sum(enter_school, na.rm = TRUE))
View(program_size)
school_cutoff
## 1.5
school_cutoff <-
ind_school_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, score) %>%
rename(school_cutoff = score) %>%
slice_head()
school_cutoff
## 1.6
school_quality <-
ind_school_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode) %>%
summarise(school_quality = mean(score))
school_quality
program_cutoff <-
ind_school_program_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, choicepgm, score) %>%
rename(program_cutoff = score) %>%
slice_head()
program_size <-
ind_school_program_enter %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_size = sum(enter_school, na.rm = TRUE))
program_quality <-
ind_school_program_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_quality = mean(score))
school_program_level <-
ind_school_program_enter %>%
distinct(schoolcode, choicepgm) %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
school_program_level <-
ind_school_program_enter %>%
group_by(schoolcode) %>%
mutate(school_size = sum(enter_school)) %>%
group_by(schoolcode, choicepgm) %>%
mutate(program_size = sum(enter_program)) %>%
filter(enter_program == TRUE & enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
mutate(program_quality = mean(score),
program_cutoff = min(score)) %>%
group_by(schoolcode) %>%
mutate(school_quality = mean(score),
school_cutoff = min(score))
school_program_level <-
ind_school_program_enter %>%
distinct(schoolcode, choicepgm) %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm"))
program_size <-
ind_school_program_enter %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_size = sum(enter_school, na.rm = TRUE))
school_program_level <-
ind_school_program_enter %>%
distinct(schoolcode, choicepgm) %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm"))
## 1.4
ind_school_enter <-
ind_school %>%
mutate(enter_school = school_rank == rankplace)
school_size <-
ind_school_enter %>%
group_by(schoolcode) %>%
summarise(school_size = sum(enter_school, na.rm = TRUE))
school_size
## 1.5
school_cutoff <-
ind_school_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, score) %>%
rename(school_cutoff = score) %>%
slice_head()
school_cutoff
## 1.6
school_quality <-
ind_school_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode) %>%
summarise(school_quality = mean(score))
school_quality
### 2
## 2.1
ind_school_program_enter <-
ind_school_enter %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank)))
program_size <-
ind_school_program_enter %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_size = sum(enter_school, na.rm = TRUE))
program_cutoff <-
ind_school_program_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, choicepgm, score) %>%
rename(program_cutoff = score) %>%
slice_head()
program_quality <-
ind_school_program_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_quality = mean(score))
school_program_level <-
ind_school_program_enter %>%
distinct(schoolcode, choicepgm) %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm"))
View(school_program_level)
## 1.2
ind_choice %>%
select(starts_with("schoolcode"), starts_with("choicepgm") ) %>%
pivot_longer(starts_with("schoolcode"), names_to = "school_rank", values_to = "schoolcode") %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(school_rank = substr(school_rank, nchar(school_rank), nchar(school_rank)),
program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank))) %>%
filter(school_rank == program_rank) %>%
select(schoolcode, choicepgm) %>%
n_distinct()
## 1.2
school_program <-
ind_choice %>%
select(starts_with("schoolcode"), starts_with("choicepgm") ) %>%
pivot_longer(starts_with("schoolcode"), names_to = "school_rank", values_to = "schoolcode") %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(school_rank = substr(school_rank, nchar(school_rank), nchar(school_rank)),
program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank))) %>%
filter(school_rank == program_rank)
gc()
library(tidyverse)
library(ggplot2)
library(scales)
# Read Data
ind_choice <- read_csv("./Data/datstu_v2.csv")
school_loc <- read_csv("./Data/datsss.csv")
home_loc <- read_csv("./Data/datjss.csv")
ind_choice <- ind_choice %>% rename(index = V1)
school_loc <- school_loc %>% select(!V1)
home_loc <- home_loc %>% select(!"...1")
### 1
## 1.1
# number of students
nrow(ind_choice)
# number of schools
ind_school <-
ind_choice %>%
pivot_longer(starts_with("schoolcode"), names_to = "school_rank", values_to = "schoolcode") %>%
mutate(school_rank = substr(school_rank, nchar(school_rank), nchar(school_rank)))
ind_school %>%
select(schoolcode) %>%
n_distinct()
# number of programs
ind_program <-
ind_choice %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm")
ind_program %>%
select(starts_with("choicepgm")) %>%
select(choicepgm) %>%
n_distinct()
## 1.2
school_program <-
ind_choice %>%
select(starts_with("schoolcode"), starts_with("choicepgm") ) %>%
pivot_longer(starts_with("schoolcode"), names_to = "school_rank", values_to = "schoolcode") %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(school_rank = substr(school_rank, nchar(school_rank), nchar(school_rank)),
program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank))) %>%
filter(school_rank == program_rank) %>%
distinct(schoolcode, choicepgm)
school_program %>% nrow()
## 1.3
ind_school_loc <-
ind_school %>%
left_join(school_loc, by = "schoolcode") %>%
mutate(near = jssdistrict == sssdistrict)
ind_school_loc_near <-
ind_school_loc %>%
filter(near == TRUE) %>%
distinct(index, .keep_all = TRUE)
ind_school_loc_near %>% n_distinct()
## 1.4
ind_school_enter <-
ind_school %>%
mutate(enter_school = school_rank == rankplace)
school_size <-
ind_school_enter %>%
group_by(schoolcode) %>%
summarise(school_size = sum(enter_school, na.rm = TRUE))
school_size
## 1.5
school_cutoff <-
ind_school_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, score) %>%
rename(school_cutoff = score) %>%
slice_head()
school_cutoff
## 1.6
school_quality <-
ind_school_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode) %>%
summarise(school_quality = mean(score))
school_quality
### 2
## 2.1
ind_school_program_enter <-
ind_school_enter %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank)))
program_size <-
ind_school_program_enter %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_size = sum(enter_school, na.rm = TRUE))
program_cutoff <-
ind_school_program_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, choicepgm, score) %>%
rename(program_cutoff = score) %>%
slice_head()
program_quality <-
ind_school_program_enter %>%
filter(enter_school == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_quality = mean(score))
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode")
?distinct
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode") %>%
distinct()
View(school_program_level)
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode") %>%
distinct() %>%
filter(!is.na(schoolname))
View(school_program_level)
school_loc <-
school_loc %>%
group_by(schoolcode) %>%
arrange(ncahr(sssdistrict)) %>%
select(!V1)
school_loc <-
school_loc %>%
group_by(schoolcode) %>%
arrange(nchar(sssdistrict)) %>%
select(!V1)
school_loc <- read_csv("./Data/datsss.csv")
school_loc <-
school_loc %>%
group_by(schoolcode) %>%
arrange(nchar(sssdistrict)) %>%
select(!V1)
View(school_loc)
school_loc <-
school_loc %>%
group_by(schoolcode) %>%
arrange(nchar(sssdistrict)) %>%
slice_tail() %>%
select(!V1)
school_loc <- read_csv("./Data/datsss.csv")
school_loc <-
school_loc %>%
group_by(schoolcode) %>%
arrange(nchar(sssdistrict)) %>%
slice_tail() %>%
select(!V1)
View(school_loc)
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode")
View(school_program_level)
school_loc <- read_csv("./Data/datsss.csv")
school_loc <-
school_loc %>%
group_by(schoolcode) %>%
filter(!is.na(schoolname)) %>%
arrange(nchar(sssdistrict)) %>%
slice_tail() %>%
select(!V1)
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode")
View(school_program_level)
1.4
ind_school_enter <-
ind_school %>%
mutate(enter_school = school_rank == rankplace)
school_size <-
ind_school_enter %>%
group_by(schoolcode) %>%
summarise(school_size = sum(enter_school, na.rm = TRUE))
school_size
_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode")
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode")
View(ind_school_program_enter)
### 2
## 2.1
ind_school_program_enter <-
ind_school_enter %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank)),
enter_program = enter_school & program_rank == school_rank)
program_size <-
ind_school_program_enter %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_size = sum(enter_program, na.rm = TRUE))
program_cutoff <-
ind_school_program_enter %>%
filter(enter_program == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
arrange(score, .by_group = TRUE) %>%
select(schoolcode, choicepgm, score) %>%
rename(program_cutoff = score) %>%
slice_head()
program_quality <-
ind_school_program_enter %>%
filter(enter_program == TRUE) %>%
group_by(schoolcode, choicepgm) %>%
summarise(program_quality = mean(score))
school_program_level <-
school_program %>%
left_join(school_size, by = "schoolcode") %>%
left_join(school_quality, by = "schoolcode") %>%
left_join(school_cutoff, by = "schoolcode") %>%
left_join(program_size, by = c("schoolcode", "choicepgm")) %>%
left_join(program_quality, by = c("schoolcode", "choicepgm")) %>%
left_join(program_cutoff, by = c("schoolcode", "choicepgm")) %>%
left_join(school_loc, by = "schoolcode")
check <-
school_program_level %>%
mutate(size_check = program_size <= school_size)
View(check)
junior_loc <- read_csv("./Data/datjss.csv")
junior_loc <- junior_loc %>% select(!"...1")
View(ind_school_enter)
View(ind_school)
View(ind_school_loc)
## 1.3
ind_school_loc <-
ind_school %>%
left_join(school_loc, by = "schoolcode") %>%
mutate(near = jssdistrict == sssdistrict)
## 1.3
ind_school_loc <-
ind_school %>%
left_join(school_loc, by = "schoolcode") %>%
mutate(near = jssdistrict == sssdistrict)
View(ind_school_loc)
View(junior_loc)
### 3
ind_school_loc %>%
left_join(junior_loc, by = "jssdistrict") %>%
rename(jsslong = point_x, jsslat = point_y)
### 3
ind_school_jun_loc <-
ind_school_loc %>%
left_join(junior_loc, by = "jssdistrict") %>%
rename(jsslong = point_x, jsslat = point_y)
### 3
ind_school_jun_loc <-
ind_school_loc %>%
left_join(junior_loc, by = "jssdistrict") %>%
rename(jsslong = point_x, jsslat = point_y) %>%
mutate(distance = sqrt( (69.172 * (ssslong-jsslong) * cos(jsslat / 57.3) )^2 + (69.172 * (ssslat-jsslat) )^2  )   )
View(ind_school_jun_loc)
View(ind_school_program_enter)
View(ind_choice)
?substr
substr("abcdef", 2, 4)
### 4
ind_recode <-
ind_school_enter %>%
mutate(scode_rev = substr(schoolcode, 1, 3))
### 4
ind_recode <-
ind_school_enter %>%
mutate(scode_rev = substr(schoolcode, 1, 3)) %>%
pivot_longer(starts_with("choicepgm"), names_to = "program_rank", values_to = "choicepgm") %>%
mutate(program_rank = substr(program_rank, nchar(program_rank), nchar(program_rank)),
enter_program = enter_school & program_rank == school_rank,
pgm_rev = ifelse(choicepgm == "General Arts" | choicepgm == "Visual Arts", "arts",
ifelse(choicepgm == "Business" | choicepgm == "Home Economics", "economics",
ifelse(choicepgm == "General Science", "science", "others"))),
choice_rev = paste(scode_rev, pgm_rev, sep = "-"))
View(ind_recode)
recode_cutoff <-
ind_recode %>%
filter(enter_program == TRUE) %>%
group_by(choice_rev) %>%
arrange(score, .by_group = TRUE) %>%
select(choice_rev, score) %>%
rename(recode_cutoff = score) %>%
slice_head()
recode_quality <-
ind_recode %>%
filter(enter_program == TRUE) %>%
group_by(choice_rev) %>%
summarise(recode_quality = mean(score))
View(recode_cutoff)
View(recode_quality)
View(ind_recode)
View(ind_recode)
?model.matrix
